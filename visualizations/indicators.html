<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FICA - Por Indicador</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/visualizations.css" rel="stylesheet">
</head>

<body>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md">
                <div id="chart"></div>
            </div>
            <div class="col-md mt-2">
                <table class="table table-striped">
                </table>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="../js/d3.min.js"></script>
    <script type="text/javascript" src="../js/main.js"></script>

    <script type="text/javascript">

        const margin = 60;
        const width = 900 - 2 * margin;
        const height = 400 - 2 * margin;

        d3.queue()
            .defer(d3.csv, "../config/indicators.csv")
            .defer(d3.csv, "../data/Global/FICA_20180228.csv")
            .await(function (error, indicators, data) {
                if (error) throw error;

                // parse values to integers
                indicators.forEach(function (ind) { ind['value'] = +ind['value']; });

                // console.log(indicators);

                // process data
                var indicatorCounter = new Array(indicators.length).fill(0);
                var indicatorStudents = new Array(indicators.length);
                for (var i = 0; i < indicatorStudents.length; i++) {
                    indicatorStudents[i] = [];
                }

                var numEntries = 0;
                data.forEach(function (entry) {
                    var i;
                    for (i = 0; i < indicators.length; i++) {
                        if (+entry[indicators[i]['column']] >= indicators[i]['value']) {

                            indicatorCounter[i]++;
                            indicatorStudents[i].push(entry);

                        }
                    }
                    numEntries++;
                    // console.log(entry);
                });

                // console.log(indicatorCounter);
                // console.log(numEntries);
                // console.log(indicatorStudents);

                var indicatorsNames = indicators.map(function (item) { return item['name']; });

                createBarChart('#chart',
                    indicatorsNames, indicatorCounter, numEntries, indicatorStudents,
                    "Indicadores", "NÂº de alunos", "Por Indicador");
            });



    </script>
</body>

</html>