<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FICA - Por Acumulação de Indicadores</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/visualizations.css" rel="stylesheet">
</head>

<body>

    <div class="container">
        <div class="row mt-1">
            <div id="chart"></div>
            <div class="ml-5 mt-5">
                <p> Número total de alunos: </p>
                <br>
                <br>
                <p> Botões de filtragem </p>
            </div>
        </div>

        <div class="row mt-5">
            <div class="table-responsive">
                <table class="table table-striped" id="studentsTable"></table>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="../js/d3.min.js"></script>
    <script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../js/main.js"></script>

    <script type="text/javascript">

        const margin = 60;
        const width = 900 - 2 * margin;
        const height = 400 - 2 * margin;

        d3.queue()
            .defer(d3.csv, "../config/indicators.csv")
            .defer(d3.csv, "../data/Global/FICA_20180228.csv")
            .await(function (error, indicators, data) {
                if (error) throw error;

                // parse values to integers
                indicators.forEach(function (ind) { ind['value'] = +ind['value']; });

                // process data
                var acumulatedIndicatorsCounter = new Array(indicators.length + 1).fill(0);

                var indicatorStudents = new Array(indicators.length);
                for (var i = 0; i < indicatorStudents.length; i++) {
                    indicatorStudents[i] = [];
                }

                var numEntries = 0;
                data.forEach(function (entry) {

                    var acumulated = 0;
                    var i;
                    for (i = 0; i < indicators.length; i++) {
                        if (+entry[indicators[i]['column']] >= indicators[i]['value']) {
                            acumulated++;
                        }
                    }

                    acumulatedIndicatorsCounter[acumulated]++;
                    indicatorStudents[acumulated].push(entry);

                    numEntries++;
                    // console.log(entry);
                });

                // console.log(acumulatedIndicatorsCounter);
                // console.log(numEntries);
                // console.log(indicatorStudents);

                var numberOfAcumulatedIndicators = ["0", "1", "2", "3", "4", "5"];
                createBarChart('#chart',
                    numberOfAcumulatedIndicators, acumulatedIndicatorsCounter, numEntries, indicatorStudents,
                    "Nº de indicadores acumulados", "Nº de alunos", "Por Acumulação de Indicadores");
            });



    </script>
</body>

</html>